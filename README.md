# üöÄ AI Travel Route Generator

Production-ready —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ travel-–º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenAI API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å Tilda Forms.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tilda Forms** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º Tilda
- ‚úÖ **OpenAI Integration** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —á–µ—Ä–µ–∑ GPT-4o-mini
- ‚úÖ **Email —Ä–∞—Å—Å—ã–ª–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ email —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ HTML —à–∞–±–ª–æ–Ω–∞–º–∏
- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫—ç—à —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ API –≤—ã–∑–æ–≤–æ–≤
- ‚úÖ **Retry –º–µ—Ö–∞–Ω–∏–∑–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö OpenAI –∏ email
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - Winston logger —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ª–æ–≥–æ–≤
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π —á–µ—Ä–µ–∑ Joi
- ‚úÖ **Security** - Helmet, CORS, Rate Limiting
- ‚úÖ **Health Checks** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ **Graceful Shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
ai-trip-server/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (OpenAI, Email, Cache)
‚îÇ   ‚îú‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã (–ø–∞—Ä—Å–∏–Ω–≥ Tilda, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ª–æ–≥–≥–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Express middleware (–ª–æ–≥–≥–µ—Ä, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ templates/       # HTML —à–∞–±–ª–æ–Ω—ã –¥–ª—è email
‚îú‚îÄ‚îÄ logs/                # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ server.js            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ package.json
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è** (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
```bash
npm install
```

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

4. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞**:
```bash
# Development
npm run dev

# Production
npm start
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI
- `SMTP_USER` –∏–ª–∏ `EMAIL_FROM` - Email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- `SMTP_PASS` - –ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è Gmail –∏–ª–∏ –ø–∞—Ä–æ–ª—å SMTP

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

–°–º. `.env.example` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email

### Gmail

1. –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: [Google Account Settings](https://myaccount.google.com/apppasswords)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env`:
```
EMAIL_PROVIDER=gmail
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
EMAIL_FROM=your-email@gmail.com
```

### SendGrid

```
EMAIL_PROVIDER=sendgrid
SENDGRID_API_KEY=your-api-key
EMAIL_FROM=your-email@yourdomain.com
```

### Mailgun

```
EMAIL_PROVIDER=mailgun
MAILGUN_API_KEY=your-api-key
MAILGUN_DOMAIN=your-domain.com
EMAIL_FROM=noreply@yourdomain.com
```

## üîå API Endpoints

### POST `/api/route`

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –∏–∑ –¥–∞–Ω–Ω—ã—Ö Tilda Forms.

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç Tilda:**
```
fields[0][name]=city&fields[0][value]=Paris
fields[1][name]=email&fields[1][value]=user@example.com
...
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ú–∞—Ä—à—Ä—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç!"
}
```

### GET `/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "uptime": "3600s",
  "memory": {
    "rss": "150MB",
    "heapTotal": "80MB",
    "heapUsed": "60MB"
  },
  "cache": {
    "keys": 10,
    "hits": 50,
    "misses": 20
  }
}
```

### GET `/`

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ.

## üîí Security

- **Helmet** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS, CSRF –∏ –¥—Ä—É–≥–∏—Ö –∞—Ç–∞–∫
- **CORS** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ CORS
- **Rate Limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 15 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **Input Validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Joi

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `logs/`:
- `error.log` - —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
- `combined.log` - –≤—Å–µ –ª–æ–≥–∏
- `exceptions.log` - –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- `rejections.log` - –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–∏—Å—ã

–†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤: —Ñ–∞–π–ª—ã –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 5MB, —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–æ 5 —Ñ–∞–π–ª–æ–≤.

## üéØ Production Deployment

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `NODE_ENV=production`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä (PM2, systemd):
```bash
pm2 start server.js --name ai-trip-server
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ reverse proxy (Nginx) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
   - Health check endpoint: `/health`
   - –õ–æ–≥–∏ –≤ `logs/` –ø–∞–ø–∫–µ
   - Winston –ª–æ–≥–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ

## üê≥ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü—Ä–∏–º–µ—Ä Dockerfile:
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

## üìù TODO / Future Improvements

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (Prometheus)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streaming –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç OpenAI
- [ ] Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

ISC


